# Test Driven Development



 Django searches for any Python module starting with "test". This is why you can store your tests in "tests.py" or "tests/test_something.py"



## Basic Unit Test



 더하기 함수를 만들고 unit test code 작성.

* `app/app/calc.py`

  ```python
  # simple add function
  def add(x, y):
      '''Add two numbers together'''
      return x+y
  ```

* unit test 코드: `app/app/tests.py`

  * Django unit test framework looks for *any* files that begin with `tests`, and uses them as the tests when running `Django run unit tests`
  * make sure that any tests are in a folder or a file name begins with `tests`

  ```python
  from django.test import TestCase
  from app.calc import add # import function to be tested
  
  class CalcTests(TestCase): # inherit TestCase
      
      def test_add_numbers(self):
          '''test that two numbers are added together'''
          self.assertEqual(add(3, 8), 11)
  ```

  * `TestCase`: Django class having a bunch of helper functions for testing Django code
  * 테스트하고 싶은 함수, 클래스 등을 import
  * `TestCase`를 상속받는 클래스 생성
    * 무엇을 테스트하고 싶은지를 항상 주석에 작성
    * 테스트하고 싶은 함수: `test`로 시작해야 Django test에서 실행
      * two components: `assertequal`을 통해 한 번에!
        * setup stage: set function up to be tested
        * assertion: actually test output and confirm that the output equals result expected
  * 터미널에서 테스트 실행

  ```bash
  docker-compose run app sh -c "python manage.py test"
  ```

  > *참고* : No such file 에러
  >
  > * settings > Shared drive > Reset credentials(Windows)





## TDD: Writing Unit Tests

 TDD 방법론을 통해 unit test를 작성하는 방법? **Write the test before writing code!**

* add a new feature to `calc` module
* that new feature should be subtracting two numbers
* new test case should fail





<br>

* `app/app/tests.py`: add a new test case

  ```python
  from django.tests import TestCase
  from app.calc import add, subtract # import subtract function 
  
  class CalcTests(TestCase):
      
      def test_add_numbers(self):
          '''test that two numbers are added together'''
          self.assertEqual(add(3, 8), 11)
          
      def test_subtract_numbers(self): # should fail
          '''test that two numbers are subtracted and returned'''
          self.assertEqual(subtract(5, 11), 6)
  ```

* 터미널에서 테스트 실행: 커맨드 동일. fail!

* `app/app/calc.py`: 

  * add subtract function. 만들었지만, return 값이 `None`이므로 fail

  ```python
  def add(x, y):
      '''Add two numbers together'''
      return x+y
  
  # should fail
  def subtract(x, y):
      pass
  ```

  * fix subtract function

  ```python
  def add(x, y):
      '''Add two numbers together'''
      return x+y
  
  def subtract(x, y):
      '''subtract x from y and return value'''
      return y-x
  ```

  * 터미널에서 테스트 실행: OK! new feature successfully added!

* add flake command to tests: run the linting as well

  ```bash
  docker-compose build # flake8 추가 후 build하지 않았으므로
  docker-compose run app sh -c "python manage.py test && flake8"
  ```

<br>

 what's the benefit?

* know my tests work: `test` string 빼먹은 경우
* high quality code: test할 수 있는 코드를 만들어야 함을 알게 됨. easy to test, easy to maintain






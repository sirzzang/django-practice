# Django Custom User Model



## core app

:one: create core app and start building project!

* core app
  * hold all of the central code that is important to the rest of the sub apps
  * create anything that is shared between one or more apps → things like *migrations, database* should be in a core module

<br>

> 지난 강의에서 만들었던 test 파일은 삭제!

* `django manage` 커맨드 이용해서 터미널에서 core app 만들기
  * run `manage.py` helper script by using Python
  * will create a new core app in the project

```shell
docker-compose run app sh -c "python manage.py startapp core"
```

* 만든 후 삭제해야 할 파일
  * `tests.py`: core app에서 테스트 파일을 삭제하는 이유는, 테스트로 시작하는 것들을 다 테스트 폴더 안에 모아 놓기 위함
  * `views.py`: core app에서 views도 필요 없음. views won't be serving anything. it justs simply **holds the database models**

* `app/core/tests` 폴더 생성: 테스트 코드 한 곳에 모아 놓는 폴더
  * `app/core/tests/__init__.py` 생성
  * easily scale up the tests if necessary



<br>

:two: add tests for custom user model!

**TDD**: write test first, and then implement the model afterwards

<br>

* `app/app/settings.py`: 설치된 앱에 `core` 앱 추가

  ```python
  ...
  
  INSTALLED_APPS = [
      'django.contrib.admin',
      'django.contrib.auth',
      'django.contrib.contenttypes',
      'django.contrib.sessions',
      'django.contrib.messages',
      'django.contrib.staticfields',
      'core', # 추가
  ]
  
  MIDDLEWARE = [
     'django.middleware.security.SecuriyMiddleware',
      ...
  ]
  ```

  

* `app/core/tests/test_models.py`

  * test if helper function for the model can **create a new user**
    * create user function
    * verify that the user has been created as expected
  * import helper function that comes with Django to get model 
    * models에서 직접 import하는 것은 비추. 언젠가는 user model을 바꾸고 싶을 수도!
    * `user manager`의 `get_user_model`의  `create_user` 함수: 나중에 만들 것
  * email과 password를 인자로 받아 유저가 만들어 졌는지, 이메일 주소가 맞고, 비밀번호가 맞는지 테스트
    * `create_user` 함수를 만들면 `user` 변수에 할당되는 user 객체가 있을 것
    * 이메일과 달리, 비밀번호는 암호화되기 때문에 같은 방식으로 테스트할 수 없음 → user model의 `check_password` 함수 사용
      * `assertTrue`: `True`인지 확인
        * `check_password` function: helper function that comes with the Django user model
        * `check_password` function will return `True` if the password is correct

  ```python
  from django.test import TestCase
  from django.contrib.auth import get_user_model
  
  class ModelTests(TestCase):
      
      def test_create_user_with_email_successful(self):
          '''Test creating a new user with an email is successful'''
          email = 'sirzzang@naver.com'
          password = 'Testpass123'
          
          # create_user 함수로 user가 만들어지는지 확인    
          user = get_user_model().objects.create_user(
              email=email,
              password=password
          )
          
          # 이메일과 비밀번호가 맞는지 테스트
          self.assertEqual(user.email, email)
          self.assertTrue(user.check_password(password))
  ```

  * unit test 진행
    * 아직 새로운 기능을 추가하지 않았기 때문에, fail해야
    * `username`이 없다는 오류가 뜨는데, `user model`을 커스터마이징하지 않았고, Django가 디폴트로 사용하는 `user model`의 standard username 필드를 사용할 것을 기대하기 때문

  ```shell
  docker-compose run app sh -c "python manage.py test"
  ```